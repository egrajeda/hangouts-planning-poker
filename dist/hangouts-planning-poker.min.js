/*! hangouts-planning-poker 02-12-2015 */
function setValue(a,b){console.debug("setValue",a,b),gapi.hangout.data.setValue(a,JSON.stringify(b))}function getValue(a){var b=null;try{b=JSON.parse(gapi.hangout.data.getValue(a))}catch(c){}return console.debug("getValue",a,b),b}function clearValue(a){gapi.hangout.data.clearValue(a)}function synchronize(a){if(!gapi.hangout.isApiReady())return!1;console.debug("synchronize"),a.user||(a.user=gapi.hangout.getLocalParticipant().person),a.participants=getValue("participants")||{};var b=0,c=!0;for(var d in a.participants){var e=getValue(d+"_selection");e||(c=!1),d===a.user.id&&e&&(a.selection=e,a.submitted=!0),b+=parseInt(e),a.participants[d].selection=e}var f=Object.keys(a.participants).length;if(f>0){a.average=b/f;var g=a.average%1;0===g?a.average+="h":a.average=parseInt(a.average)+"h "+Math.round(60*g)+"m"}else c=!1;return a.completed=c,!0}var app=angular.module("app",["ngAnimate"]);app.controller("MainCtrl",["$scope","$timeout",function(a,b){a.participants=[],b(function(){console.log("Attempting to synchronize with Hangout..."),synchronize(a)},1e3),a.join=function(){if(!a.user)return void console.debug("Attempted to join, but user is not set.");var b=getValue("participants")||{};b[a.user.id]={id:a.user.id,name:a.user.displayName,image:a.user.image.url},setValue("participants",b),a.player=!0},a.leave=function(){if(!a.user)return void console.debug("Attempted to leave, but user is not set.");var b=getValue("participants")||{};delete b[a.user.id],setValue("participants",b),a.player=!1,a.clear()},a.select=function(b){a.player&&!a.submitted&&(a.selection=b)},a.submit=function(){a.selection&&(a.submitted=!0,setValue(a.user.id+"_selection",a.selection.toString()))},a.clear=function(){delete a.selection,a.submitted=!1,clearValue(a.user.id+"_selection")},gapi.hangout.data.onStateChanged.add(function(b){a.$apply(function(){synchronize(a)})})}]);